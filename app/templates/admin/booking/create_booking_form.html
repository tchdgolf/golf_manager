{% extends "base.html" %}
{% import "bootstrap/wtf.html" as wtf %}

{% block title %}{{ title }} - 관리자{% endblock %}

{% block content %}
<h2 class="mb-4">{{ title }}</h2>

<form method="POST" novalidate>
    {# BookingForm 렌더링 (quick_form 또는 form_field 사용) #}
    {{ form.hidden_tag() }}

    <div class="row">
        <div class="col-md-6">
            {{ wtf.form_field(form.user_id, choices=[('', '회원 선택')] + [(u.id, u.name + ' (' + u.phone + ')') for u in users]) }}
        </div>
        <div class="col-md-6">
             {{ wtf.form_field(form.booth_id, choices=[('', '타석 선택')] + [(b.id, b.name) for b in booths]) }}
        </div>
    </div>
     <div class="row mb-3">
        <div class="col-md-6">
            {{ wtf.form_field(form.booking_type, id="booking_type_select") }}
        </div>
        <div class="col-md-6" id="pro_select_div"> {# 프로 선택 필드 숨김/표시용 div #}
             {{ wtf.form_field(form.pro_id, choices=[('', '프로 선택')] + [(p.id, p.name) for p in pros]) }}
        </div>
    </div>
    <div class="row mb-3">
         <div class="col-md-6">
            {{ wtf.form_field(form.start_time) }}
        </div>
        <div class="col-md-6">
             {{ wtf.form_field(form.end_time) }}
        </div>
    </div>
    {{ wtf.form_field(form.memo, rows=3) }}

    <div class="mt-4">
        {{ wtf.form_field(form.submit, class="btn btn-primary") }}
        <a href="{{ url_for('admin.list_bookings') }}" class="btn btn-secondary ms-2">취소</a>
    </div>
</form>
{% endblock %}

{% block scripts %}
{{ super() }}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
{# 예약 유형 선택 시 프로 선택 필드 표시/숨김 JS #}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const bookingTypeSelect = document.getElementById('booking_type_select');
        const proSelectDiv = document.getElementById('pro_select_div');
        const proSelectField = document.getElementById('pro_id'); // pro_id 필드의 실제 ID 확인 필요

        function toggleProSelect() {
            if (bookingTypeSelect && proSelectDiv) {
                // BookingType.LESSON 의 name 이 'LESSON' 이라고 가정
                if (bookingTypeSelect.value === 'LESSON') {
                    proSelectDiv.style.display = 'block';
                    if(proSelectField) proSelectField.required = true; // 필수 입력으로 설정 (선택적)
                } else {
                    proSelectDiv.style.display = 'none';
                     if(proSelectField) {
                         proSelectField.required = false; // 필수 해제
                         proSelectField.value = ''; // 값 비우기
                     }
                }
            }
        }

        if (bookingTypeSelect) {
            bookingTypeSelect.addEventListener('change', toggleProSelect);
            toggleProSelect(); // 초기 상태 설정
        }
    });
</script>
{% endblock %}